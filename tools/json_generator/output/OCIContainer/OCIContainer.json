{
    "$schema": "https://raw.githubusercontent.com/rdkcentral/entservices-apis/refs/heads/main/tools/md_generator/json2md/schemas/interface.schema.json",
    "jsonrpc": "2.0",
    "info": {
      "title": "OCIContainer API",
      "class": "OCIContainer",
      "description": "The `OCIContainer` plugin allows for control of OCI containers using the Dobby hypervisor"
    },
    "common": {
        "$ref": "../common/common.json"
    },
    "definitions": {
        "containerId": {
            "summary": "The ID of a container as returned by `listContainers`",
            "type": "string",
            "example": "com.bskyb.epgui"
        },
        "state": {
            "summary": "The container state",
            "enum": [
                "Invalid",
                "Starting",
                "Running",
                "Stopping",
                "Paused",
                "Stopped",
                "Hibernating",
                "Hibernated",
                "Awakening"
            ],
            "type": "string",
            "example": "Running"
        },
        "Descriptor": {
            "summary": "The container descriptor",
            "type": "integer",
            "example": 91
        },
        "command": {
            "summary": "Command to execute",
            "type": "string",
            "example": "command"
        },
        "name": {
            "summary":"Name of the Container.",
            "type":"string",
            "example":"com.bskyb.epgui"
        },
        "error": {
            "summary":"Failure error code",
            "type":"integer",
            "error": 1
        },
        "errorReason": {
            "summary": "A user-defined description explaining the reason for the failure. if success error field will be empty string",
            "type": "string",
            "error": " "
        },
        "annotationKey": {
            "summary": "Updating the property key of the given container ID",
            "type": "string",
            "example": "fireboltState"
        },
        "annotationKeyValue": {
            "summary": "Updating the value of the property key of the given container ID",
            "type": "string",
            "example": "foreground"
        }
    },
    "methods": {
        "listContainers":{
            "summary": "Lists all running OCI containers Dobby knows about.",
            "result": {
                "type": "object",
                "properties": {
                    "containers": {
                        "summary": "A list of running containers",
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "Descriptor": {
                                    "$ref": "#/definitions/Descriptor"
                                },
                                "Id": {
                                    "summary": "The container Id",
                                    "type": "string",
                                    "example": "com.bskyb.epgui"
                                }
                            },
                            "required": [
                                "Descriptor",
                                "Id"
                            ]
                        }
                    },
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "containers",
                    "success",
                    "errorReason"
                ]
            }
        },
        "getContainerInfo":{
            "summary": "Gets information about a running container such as CPU, memory, and GPU usage (GPU not supported on some products).",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    }
                },
                "required": [
                    "containerId"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "info": {
                        "summary": "Information about the specified container",
                        "type": "object",
                        "properties": {
                            "cpu": {
                                "summary": "CPU information",
                                "type": "object",
                                "properties": {
                                    "usage": {
                                        "summary": "The amount of CPU usage",
                                        "type": "object",
                                        "properties": {
                                            "percpu": {
                                                "summary": "The usage for each CPU",
                                                "type": "array",
                                                "items": {
                                                    "type": "integer",
                                                    "example": 83134464184
                                                }
                                            },
                                            "total": {
                                                "summary": "The combined usage for all CPUs",
                                                "type": "integer",
                                                "example": 224025108679
                                            }
                                        },
                                        "required": [
                                            "percpu",
                                            "total"
                                        ]
                                    }
                                },
                                "required": [
                                    "usage"        
                                ]
                            },                        
                            "id": {
                                "$ref": "#/definitions/containerId"
                            },
                            "memory": {
                                "summary": "The amount of memory being used by the container",
                                "type": "object",
                                "properties": {
                                    "user": {
                                        "summary": "User memory statistics",
                                        "type": "object",
                                        "properties": {
                                            "failcnt": {
                                                "summary": "The fail count; the number of times that the usage counter hit its limit",
                                                "type": "integer",
                                                "example": 0
                                            },
                                            "limit": {
                                                "summary": "The memory limit",
                                                "type": "integer",
                                                "example": 230686720
                                            },
                                            "max": {
                                                "summary": "The maximum amount of memory used",
                                                "type": "integer",
                                                "example": 38555648
                                            },
                                            "usage": {
                                                "summary": "The current memory being used",
                                                "type": "integer",
                                                "example": 28655616
                                            }
                                        },
                                        "required": [
                                            "failcnt",
                                            "limit",
                                            "max",
                                            "usage"
                                        ]   
                                    }
                                },
                                "required": [
                                    "user"
                                ]
                            },
                            "pids": {
                                "summary": "A list of container process IDs",
                                "type": "array",
                                "items": {
                                    "type": "integer",
                                    "example": 7644
                                }
                            },
                            "state": {
                                "$ref": "#/definitions/state"
                            },
                            "timestamp": {
                                "summary": "The timestamp for container information",
                                "type": "integer",
                                "example": 6849968158125
                            }
                        },
                        "required": [
                            "cpu",
                            "id",
                            "memory",
                            "pids",
                            "state",
                            "timestamp"
                        ]
                    },
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "info",
                    "success",
                    "errorReason"
                ]
            }
        },
        "getContainerState":{
            "summary": "Gets the state of a currently running container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    }
                },
                "required": [
                    "containerId"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "state": {
                        "summary": "The container state",
                        "enum": [
                            "Invalid",
                            "Starting",
                            "Running",
                            "Stopping",
                            "Paused",
                            "Stopped",
                            "Hibernating",
                            "Hibernated",
                            "Awakening"
                        ],
                        "type": "string",
                        "example": "Running"
                    },
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "containerId",
                    "state",
                    "success",
                    "errorReason"
                ]
            }
        },
        "startContainer":{
            "summary": "Starts a new container from an existing OCI bundle.",
            "events": {
               "onContainerStarted" : "Triggers when a new container starts running."
            },
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "bundlePath": {
                        "summary": "Path to the OCI bundle containing the rootfs and config to use to create the container",
                        "type": "string",
                        "example": "/containers/myBundle"
                    },
                    "command": {
                        "$ref": "#/definitions/command"
                    },
                    "westerosSocket":{
                        "summary": "Path to a Westeros socket to mount inside the container",
                        "type": "string",
                        "example": "/usr/mySocket"
                    }
                },
                "required": [
                    "containerId",
                    "bundlePath"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "descriptor": {
                        "$ref": "#/definitions/Descriptor"
                    },
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "descriptor",
                    "success",
                    "errorReason"
                ]
            }
        },
        "startContainerFromDobbySpec":{
            "summary": "Starts a new container from a legacy Dobby JSON specification.",
            "events": {
               "onContainerStarted"  : "Triggers when a new container starts running."
            },
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "dobbySpec": {
                        "summary": "Dobby specification to use for the container",
                        "type": "string",
                        "example": "/containers/dobbySpec"
                    },
                    "command": {
                        "$ref": "#/definitions/command"
                    },
                    "westerosSocket":{
                        "summary": "Path to a Westeros socket to mount inside the container",
                        "type": "string",
                        "example": "/usr/mySocket"
                    }
                },
                "required": [
                    "containerId",
                    "dobbySpec"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "descriptor": {
                        "$ref": "#/definitions/Descriptor"
                    },
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "descriptor",
                    "success",
                    "errorReason"
                ]
            }
        },
        "stopContainer":{
            "summary": "Stops a currently running container.",
            "events": {
               "onContainerStopped" : "Triggers when the container stops running."
            },
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "force": {
                        "summary": "If `true`, force stop the container using the `SIGKILL` signal). Otherwise, use the `SIGTERM` signal. The default value if no value is specified is `false`.",
                        "type": "boolean",
                        "example": true
                    }
                },
                "required": [
                    "containerId"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "pauseContainer":{
            "summary": "Pauses a currently running container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    }
                },
                "required": [
                    "containerId"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "resumeContainer":{
            "summary": "Resumes a previously paused container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    }
                },
                "required": [
                    "containerId"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "hibernateContainer":{
            "summary": "Hibernate the container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "options": {
                        "summary": "Hibernation options - Optional parameter",
                        "type": "string",
                        "example": " "
                    }
                },
                "required": [
                    "containerId",
                    "options"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "wakeupContainer":{
            "summary": "Wakeup the container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    }
                },
                "required": [
                    "containerId"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "executeCommand":{
            "summary": "Executes a command inside a running container. The path to the executable must resolve within the container's namespace.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "options": {
                        "summary": "Global options for crun `exec` command",
                        "type": "string",
                        "example": "--cwd=PATH"
                    },
                    "command": {
                        "$ref": "#/definitions/command"
                    }
                },
                "required": [
                    "containerId",
                    "command"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "annotate":{
            "summary": "Update the container properties of running container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "key": {
                        "$ref": "#/definitions/annotationKey"
                    },
                    "value": {
                        "$ref": "#/definitions/annotationKeyValue"
                    }
                },
                "required": [
                    "containerId",
                    "key",
                    "value"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "removeAnnotation":{
            "summary": "Remove the container properties of the given container Id.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "key": {
                        "$ref": "#/definitions/annotationKey"
                    }
                },
                "required": [
                    "containerId",
                    "key"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "mount":{
            "summary": "Mount a path in container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "source": {
                        "summary": "Source path to mount",
                        "type": "string",
                        "example": "/tmp/testdisplay"
                    },
                    "target": {
                        "summary": "Destination path to mount",
                        "type": "string",
                        "example": "/tmp/westeros"
                    },
                    "type": {
                        "summary": "The type of mount to be performed",
                        "type": "string",
                        "example": "bind"
                    },
                    "options": {
                        "summary": "The options is a list of mount options that modify the behavior of the mount",
                        "type": "string",
                        "example": "rbind, nosuid, nodev, ro"
                    }
                },
                "required": [
                    "containerId",
                    "source",
                    "target",
                    "type",
                    "options"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        },
        "unmount":{
            "summary": "Unmount a path in container.",
            "params": {
                "type": "object",
                "properties": {
                    "containerId": {
                        "$ref": "#/definitions/containerId"
                    },
                    "target": {
                        "summary": "Destination path to mount",
                        "type": "string",
                        "example": "/tmp/westeros"
                    }
                },
                "required": [
                    "containerId",
                    "target"
                ]
            },
            "result": {
                "type": "object",
                "properties": {
                    "success":{
                        "$ref": "#/common/success"
                    },
                    "errorReason":{
                        "$ref": "#/definitions/errorReason"
                    }
                },
                "required": [
                    "success",
                    "errorReason"
                ]
            }
        }
    },
    "events": {
        "onContainerStarted":{
            "summary":"Triggered when a new container has started running.",
            "params":{
                "type":"object",
                "properties": {
                    "containerId":{
                        "$ref": "#/definitions/containerId"
                    },
                    "name":{
                        "$ref": "#/definitions/name"
                    }
                },
                "required": [
                    "containerId",
                    "name"
                ]
            }
        },
        "onContainerStopped":{
            "summary": "Triggered when the container has stopped running.",
            "params": {
                "type":"object",
                "properties": {
                    "containerId":{
                        "$ref": "#/definitions/containerId"
                    },
                    "name":{
                        "$ref": "#/definitions/name"
                    }
                },
                "required": [
                    "containerId",
                    "name"
                ]
            }
        },
        "onContainerFailed":{
            "summary": "Triggered when the container execution is failed.",
            "params": {
                "type":"object",
                "properties": {
                    "containerId":{
                        "$ref": "#/definitions/containerId"
                    },
                    "name":{
                        "$ref": "#/definitions/name"
                    },
                    "error":{
                        "$ref": "#/definitions/error"
                    }
                },
                "required": [
                    "containerId",
                    "name",
                    "error"
                ]
            }
        },
        "OnContainerStateChanged":{
            "summary": "Triggered when the container state has changed.",
            "params": {
                "type":"object",
                "properties": {
                    "containerId":{
                        "$ref": "#/definitions/containerId"
                    },
                    "state":{
                        "$ref": "#/definitions/state"
                    }
                },
                "required": [
                    "containerId",
                    "state"
                ]
            }
        }
        
    }
}